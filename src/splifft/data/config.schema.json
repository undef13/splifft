{
  "$defs": {
    "AudioIOConfig": {
      "additionalProperties": false,
      "properties": {
        "target_sample_rate": {
          "default": 44100,
          "exclusiveMinimum": 0,
          "title": "Target Sample Rate",
          "type": "integer"
        },
        "force_channels": {
          "anyOf": [
            {
              "exclusiveMinimum": 0,
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": 2,
          "title": "Force Channels"
        }
      },
      "title": "AudioIOConfig",
      "type": "object"
    },
    "CqtConfig": {
      "additionalProperties": false,
      "description": "Configuration for harmonic CQT feature extraction.\n\nThis intentionally matches PESTO's HCQT preprocessor defaults so we can\nshare checkpoints without adding SciPy or nnAudio.",
      "properties": {
        "kind": {
          "const": "cqt",
          "title": "Kind",
          "type": "string"
        },
        "hop_size_ms": {
          "default": 10.0,
          "title": "Hop Size Ms",
          "type": "number"
        },
        "harmonics": {
          "default": [
            1
          ],
          "items": {
            "exclusiveMinimum": 0,
            "type": "integer"
          },
          "minLength": 1,
          "title": "Harmonics",
          "type": "array",
          "unique_items": true
        },
        "fmin": {
          "default": 27.5,
          "title": "Fmin",
          "type": "number"
        },
        "fmax": {
          "anyOf": [
            {
              "type": "number"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Fmax"
        },
        "bins_per_semitone": {
          "default": 3,
          "exclusiveMinimum": 0,
          "title": "Bins Per Semitone",
          "type": "integer"
        },
        "n_bins": {
          "default": 251,
          "exclusiveMinimum": 0,
          "title": "N Bins",
          "type": "integer"
        },
        "center_bins": {
          "default": true,
          "title": "Center Bins",
          "type": "boolean"
        },
        "gamma": {
          "default": 7.0,
          "title": "Gamma",
          "type": "number"
        },
        "center": {
          "default": true,
          "title": "Center",
          "type": "boolean"
        },
        "log_epsilon": {
          "default": 1e-08,
          "title": "Log Epsilon",
          "type": "number"
        }
      },
      "required": [
        "kind"
      ],
      "title": "CqtConfig",
      "type": "object"
    },
    "InferenceConfig": {
      "additionalProperties": false,
      "properties": {
        "batch_size": {
          "default": 8,
          "exclusiveMinimum": 0,
          "title": "Batch Size",
          "type": "integer"
        },
        "requested_stems": {
          "anyOf": [
            {
              "items": {
                "minLength": 1,
                "type": "string"
              },
              "minLength": 1,
              "type": "array",
              "unique_items": true
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Requested Stems"
        },
        "force_weights_dtype": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Force Weights Dtype"
        },
        "use_autocast_dtype": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Use Autocast Dtype"
        },
        "model_device": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Model Device"
        },
        "io_device": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Io Device"
        },
        "compile_model": {
          "anyOf": [
            {
              "$ref": "#/$defs/TorchCompileConfig"
            },
            {
              "type": "null"
            }
          ],
          "default": null
        }
      },
      "title": "InferenceConfig",
      "type": "object"
    },
    "LazyModelConfig": {
      "additionalProperties": true,
      "description": "A lazily validated model configuration.\n\nNote that it is not guaranteed to be fully valid until `to_concrete` is called.",
      "properties": {
        "chunk_size": {
          "exclusiveMinimum": 0,
          "title": "Chunk Size",
          "type": "integer"
        },
        "output_stem_names": {
          "items": {
            "minLength": 1,
            "type": "string"
          },
          "minLength": 1,
          "title": "Output Stem Names",
          "type": "array",
          "unique_items": true
        }
      },
      "required": [
        "chunk_size",
        "output_stem_names"
      ],
      "title": "LazyModelConfig",
      "type": "object"
    },
    "LogMelConfig": {
      "additionalProperties": false,
      "description": "Configuration for Log-Mel Spectrogram.",
      "properties": {
        "kind": {
          "const": "mel",
          "title": "Kind",
          "type": "string"
        },
        "n_fft": {
          "exclusiveMinimum": 0,
          "title": "N Fft",
          "type": "integer"
        },
        "hop_length": {
          "exclusiveMinimum": 0,
          "title": "Hop Length",
          "type": "integer"
        },
        "n_mels": {
          "exclusiveMinimum": 0,
          "title": "N Mels",
          "type": "integer"
        },
        "sample_rate": {
          "exclusiveMinimum": 0,
          "title": "Sample Rate",
          "type": "integer"
        },
        "f_min": {
          "default": 0.0,
          "title": "F Min",
          "type": "number"
        },
        "f_max": {
          "anyOf": [
            {
              "type": "number"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "F Max"
        },
        "mel_scale": {
          "default": "slaney",
          "enum": [
            "htk",
            "slaney"
          ],
          "title": "Mel Scale",
          "type": "string"
        },
        "normalized": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "const": "frame_length",
              "type": "string"
            }
          ],
          "default": "frame_length",
          "title": "Normalized"
        },
        "power": {
          "default": 1.0,
          "title": "Power",
          "type": "number"
        },
        "log_multiplier": {
          "default": 1000.0,
          "title": "Log Multiplier",
          "type": "number"
        }
      },
      "required": [
        "kind",
        "n_fft",
        "hop_length",
        "n_mels",
        "sample_rate"
      ],
      "title": "LogMelConfig",
      "type": "object"
    },
    "MaskingConfig": {
      "additionalProperties": false,
      "properties": {
        "add_sub_dtype": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Add Sub Dtype"
        },
        "out_dtype": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Out Dtype"
        }
      },
      "title": "MaskingConfig",
      "type": "object"
    },
    "NormalizationConfig": {
      "additionalProperties": false,
      "properties": {
        "enabled": {
          "default": false,
          "title": "Enabled",
          "type": "boolean"
        }
      },
      "title": "NormalizationConfig",
      "type": "object"
    },
    "OutputConfig": {
      "additionalProperties": false,
      "properties": {
        "stem_names": {
          "anyOf": [
            {
              "const": "all",
              "type": "string"
            },
            {
              "items": {
                "minLength": 1,
                "type": "string"
              },
              "minLength": 1,
              "type": "array",
              "unique_items": true
            }
          ],
          "default": "all",
          "title": "Stem Names"
        },
        "file_format": {
          "default": "flac",
          "enum": [
            "flac",
            "wav",
            "ogg",
            "npy"
          ],
          "title": "File Format",
          "type": "string"
        },
        "bit_rate": {
          "anyOf": [
            {
              "enum": [
                8,
                16,
                24,
                32,
                64
              ],
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Bit Rate"
        }
      },
      "title": "OutputConfig",
      "type": "object"
    },
    "SequenceChunkingConfig": {
      "additionalProperties": false,
      "properties": {
        "trim_margin": {
          "default": 0,
          "minimum": 0,
          "title": "Trim Margin",
          "type": "integer"
        },
        "overlap_mode": {
          "default": "keep_first",
          "enum": [
            "keep_first",
            "keep_last"
          ],
          "title": "Overlap Mode",
          "type": "string"
        },
        "avoid_short_end": {
          "default": true,
          "title": "Avoid Short End",
          "type": "boolean"
        }
      },
      "title": "SequenceChunkingConfig",
      "type": "object"
    },
    "StftConfig": {
      "additionalProperties": false,
      "description": "configuration for the short-time fourier transform.",
      "properties": {
        "kind": {
          "const": "stft",
          "title": "Kind",
          "type": "string"
        },
        "n_fft": {
          "default": 2048,
          "exclusiveMinimum": 0,
          "title": "N Fft",
          "type": "integer"
        },
        "hop_length": {
          "default": 512,
          "exclusiveMinimum": 0,
          "title": "Hop Length",
          "type": "integer"
        },
        "win_length": {
          "default": 2048,
          "exclusiveMinimum": 0,
          "title": "Win Length",
          "type": "integer"
        },
        "window_shape": {
          "default": "hann",
          "enum": [
            "hann",
            "hamming",
            "linear_fade"
          ],
          "title": "Window Shape",
          "type": "string"
        },
        "normalized": {
          "default": false,
          "title": "Normalized",
          "type": "boolean"
        },
        "conv_dtype": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Conv Dtype"
        }
      },
      "required": [
        "kind"
      ],
      "title": "StftConfig",
      "type": "object"
    },
    "SubtractConfig": {
      "additionalProperties": false,
      "properties": {
        "operation": {
          "const": "subtract",
          "title": "Operation",
          "type": "string"
        },
        "stem_name": {
          "minLength": 1,
          "title": "Stem Name",
          "type": "string"
        },
        "by_stem_name": {
          "minLength": 1,
          "title": "By Stem Name",
          "type": "string"
        }
      },
      "required": [
        "operation",
        "stem_name",
        "by_stem_name"
      ],
      "title": "SubtractConfig",
      "type": "object"
    },
    "SumConfig": {
      "additionalProperties": false,
      "properties": {
        "operation": {
          "const": "sum",
          "title": "Operation",
          "type": "string"
        },
        "stem_names": {
          "items": {
            "minLength": 1,
            "type": "string"
          },
          "minLength": 1,
          "title": "Stem Names",
          "type": "array",
          "unique_items": true
        }
      },
      "required": [
        "operation",
        "stem_names"
      ],
      "title": "SumConfig",
      "type": "object"
    },
    "TorchCompileConfig": {
      "properties": {
        "fullgraph": {
          "default": true,
          "title": "Fullgraph",
          "type": "boolean"
        },
        "dynamic": {
          "default": true,
          "title": "Dynamic",
          "type": "boolean"
        },
        "mode": {
          "default": "reduce-overhead",
          "enum": [
            "default",
            "reduce-overhead",
            "max-autotune",
            "max-autotune-no-cudagraphs"
          ],
          "title": "Mode",
          "type": "string"
        }
      },
      "title": "TorchCompileConfig",
      "type": "object"
    },
    "WaveformChunkingConfig": {
      "additionalProperties": false,
      "properties": {
        "method": {
          "const": "overlap_add_windowed",
          "default": "overlap_add_windowed",
          "title": "Method",
          "type": "string"
        },
        "overlap_ratio": {
          "default": 0.5,
          "exclusiveMaximum": 1,
          "minimum": 0,
          "title": "Overlap Ratio",
          "type": "number"
        },
        "window_shape": {
          "default": "hann",
          "enum": [
            "hann",
            "hamming",
            "linear_fade"
          ],
          "title": "Window Shape",
          "type": "string"
        },
        "padding_mode": {
          "default": "reflect",
          "enum": [
            "reflect",
            "constant",
            "replicate"
          ],
          "title": "Padding Mode",
          "type": "string"
        }
      },
      "title": "WaveformChunkingConfig",
      "type": "object"
    }
  },
  "additionalProperties": false,
  "properties": {
    "identifier": {
      "title": "Identifier",
      "type": "string"
    },
    "model_type": {
      "title": "Model Type",
      "type": "string"
    },
    "model": {
      "$ref": "#/$defs/LazyModelConfig"
    },
    "transform": {
      "anyOf": [
        {
          "discriminator": {
            "mapping": {
              "cqt": "#/$defs/CqtConfig",
              "mel": "#/$defs/LogMelConfig",
              "stft": "#/$defs/StftConfig"
            },
            "propertyName": "kind"
          },
          "oneOf": [
            {
              "$ref": "#/$defs/StftConfig"
            },
            {
              "$ref": "#/$defs/LogMelConfig"
            },
            {
              "$ref": "#/$defs/CqtConfig"
            }
          ]
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Transform"
    },
    "audio_io": {
      "$ref": "#/$defs/AudioIOConfig"
    },
    "inference": {
      "$ref": "#/$defs/InferenceConfig"
    },
    "normalization": {
      "$ref": "#/$defs/NormalizationConfig"
    },
    "waveform_chunking": {
      "anyOf": [
        {
          "$ref": "#/$defs/WaveformChunkingConfig"
        },
        {
          "type": "null"
        }
      ],
      "default": null
    },
    "sequence_chunking": {
      "anyOf": [
        {
          "$ref": "#/$defs/SequenceChunkingConfig"
        },
        {
          "type": "null"
        }
      ],
      "default": null
    },
    "masking": {
      "$ref": "#/$defs/MaskingConfig"
    },
    "derived_stems": {
      "anyOf": [
        {
          "additionalProperties": {
            "discriminator": {
              "mapping": {
                "subtract": "#/$defs/SubtractConfig",
                "sum": "#/$defs/SumConfig"
              },
              "propertyName": "operation"
            },
            "oneOf": [
              {
                "$ref": "#/$defs/SubtractConfig"
              },
              {
                "$ref": "#/$defs/SumConfig"
              }
            ]
          },
          "propertyNames": {
            "minLength": 1
          },
          "type": "object"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Derived Stems"
    },
    "output": {
      "$ref": "#/$defs/OutputConfig"
    },
    "experimental": {
      "anyOf": [
        {
          "additionalProperties": true,
          "type": "object"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Experimental"
    }
  },
  "required": [
    "identifier",
    "model_type",
    "model"
  ],
  "title": "Config",
  "type": "object"
}